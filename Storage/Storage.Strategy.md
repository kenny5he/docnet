# 存储策略 (Storage Strategy)
## 磁盘存储策略
### 磁盘存储冗余阵列RAID
RAID即独立磁盘冗余阵列，通常简称为磁盘阵列。简单理解就是多个磁盘组合在一起使用，相较于单个磁盘提高了I/O读写性能，因为多个磁盘并行读写肯定比单个磁盘效率高；同时提高了数据容错性，把一份数据放在多个磁盘中，数据的可靠性必然提高
磁盘怎么组合，数据怎么存储，一份数据存储在几个磁盘上，就是接下来要讨论的问题
我们要考虑的问题主要有三个：磁盘的利用率、磁盘的性能、数据的安全性
最好的方式肯定是三个最高：利用率，性能，安全。但实际是三者不可兼得，所以根据不同用户对数据的要求不同，实现其中的一个或两个，于是就有了RAID等级的划分
SNIA 、 Berkeley 等组织机构把 RAID0 、 RAID1 、 RAID2 、 RAID3 、 RAID4 、 RAID5 、 RAID6 七个等级定为标准的 RAID 等级

## 分布式存储
对于存储用户而言，存储系统的可靠性、性能、成本，是用户非常关注的几个方面。
传统的存储中，大多是采用RAID的方式，来保证数据的高可靠性；而在分布式存储系统中，HDFS（Hadoop2.0 Distributed File System）为了保证数据的可靠性默认数据存储策略是3副本，即在写入数据的时候，会占用该数据大小3倍的空间，这样就造成了大量的空间浪费。对此，Hadoop3.0 HDFS 引入在RAID磁盘阵列中已应用成熟的技术：EC（Erasure Coding，纠删码）。

### 多副本
多副本就是一份数据以副本的方式写到多个分布式系统中的存储节点中。这种多副本的数据保护方式，一来实现简单，而来可靠性高。除非所有副本所在的存储节点都故障，才会影响业务；除此之外，可以从未故障的其他副本读取数据以保证业务。但是多副本的空间利用率偏低，以三副本为例，存储空间利用率为33%，这也增加了企业级用户的存储成本。

### Erasure Code (简称: EC, 中文: 纠删码)
EC是一种编码容错技术，最早用于通信行业数据传输中的数据恢复。主要应用在网络传输中避免包的丢失， 存储系统利用它来提高 存储 可靠性。相比多副本复制而言， 纠删码能够以更小的数据冗余度获得更高数据可靠性， 但编码方式较复杂，需要大量计算 。纠删码只能容忍数据丢失，无法容忍数据篡改，纠删码正是得名与此。Hadoop3.0版本将EC加入到HDFS中。
1. 常见EC算法
    1. RS(Reed Solomon)：族系里面最基础的算法，具有最小的存储开销，最慢的编解码性能，最大的网络带宽开销。
    2. CRS(Cauchy RS)：对RS算法数值型的编解码矩阵改为位矩阵（只有0和1两个值），把有限域的乘法运算变成XOR操作，XOR运算的次数取决于矩阵中1的个数，编解码比RS快了4至6倍。
    3. LRC(Locally Reconstruct Code)：对RS算法的网络带宽开销做了改进，对数据块分组，恢复数据时只有组内的块参与运算，而不需要所有的块，对于单个磁盘失效产生的数据恢复，带宽开销减少了50%，但对于组内多个磁盘失效的场景，带宽开销还是与RS一样。
    4. HitchHiker：对网络带宽开销做了改进，采用了Hop-and-Couple的思想对数据块编码，这么做的副作用是把编码性能降低了。
    5. SEC(Shingle Erasure Code)：解决了LRC对多个磁盘失效的不足，仍采用了分组的策略，一个组包含的数据块与相邻组的块存在重叠，多块磁盘失效的情况下，总能从本组和另一个组内取出数据块做恢复，这种做法的副作用是增加了存储开销。


- 腾讯云 Reed-Solomon纠删码原理(超详细): https://cloud.tencent.com/developer/article/1774225
- EC与多副本的对比分析: https://blog.csdn.net/zhangchen16/article/details/128325055
- 华为通信 科普文章: https://forum.huawei.com/enterprise/zh/thread/580893955082567680
- 滴滴HDFS EC实践: https://mp.weixin.qq.com/s/AW0MmiBxTlkweJFaluu4vQ
- Erasure Code EC纠删码原理: https://blog.csdn.net/qq_29110265/article/details/86519879
- Reed Solomon 纠删码: https://www.jianshu.com/p/3936a8698d36